<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SOIXIOS Meme Coin Radar | PATCH TRUE FUTURES FALLBACK</title>
  <style>
    body {
      background-color: black;
      color: white;
      font-family: monospace;
      padding: 2rem;
    }
    h1 {
      font-size: 1.8rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #333;
      padding: 0.8rem;
      text-align: center;
    }
    th {
      background-color: #111;
    }
    .green { color: lime; }
    .red { color: red; }
    .ema-long { color: #00ffff; font-weight: bold; }
    .ema-short { color: #d900ff; font-weight: bold; }
    .ema-none { color: gray; font-weight: bold; }
    .tabs button {
      margin-right: 1rem;
      background: #111;
      color: white;
      border: 1px solid #555;
      padding: 0.5rem 1rem;
      cursor: pointer;
    }
    .tabs button.active {
      background: lime;
      color: black;
    }
    select, input[type="text"] {
      margin-left: 1rem;
      padding: 0.4rem;
      background: #111;
      color: white;
      border: 1px solid #555;
    }
    #refresh-counter {
      float: right;
      font-size: 1rem;
      color: yellow;
    }
  </style>
</head>
<body>
  <h1>üöÄ SOIXIOS Binance BNB Chain Meme Coin Radar (PATCH TRUE FUTURES FALLBACK) <span id="refresh-counter">‚è≥ 60</span></h1>
  <p>Tracking EMA Logic Only (Long / Short / None)</p>

  <div class="tabs">
    <button onclick="showTab('all')" class="active">All</button>
    <button onclick="showTab('long')">EMA LONG</button>
    <button onclick="showTab('short')">EMA SHORT</button>
  </div>

  <p>Favorites (comma-separated):</p>
  <input type="text" id="coinInput" value="DOGEUSDT,SHIBUSDT,PEPEUSDT,ARCUSDT.P,ALCHUSDT.P,FUNUSDT" style="width: 100%;" />

  <table id="radar-table">
    <thead>
      <tr>
        <th>Symbol</th>
        <th>Close (H-L)</th>
        <th>3M</th>
        <th>5M</th>
        <th>15M</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let refreshCountdown = 60;

    function calcEMA(data, length) {
      const k = 2 / (length + 1);
      let ema = parseFloat(data[0][4]);
      for (let i = 1; i < data.length; i++) {
        ema = data[i][4] * k + ema * (1 - k);
      }
      return parseFloat(ema);
    }

    async function getValidKlines(symbolInput, interval) {
      const testSymbols = [];

      const base = symbolInput.replace(".P", "");
      testSymbols.push(base);

      if (symbolInput.endsWith(".P")) {
        testSymbols.unshift(symbolInput);
      }

      for (let symbol of testSymbols) {
        try {
          let res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=15`);
          let data = await res.json();
          if (Array.isArray(data) && data.length && data[0][0]) return data;
        } catch (e) {}

        try {
          let res = await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${symbol}&interval=${interval}&limit=15`);
          let data = await res.json();
          if (Array.isArray(data) && data.length && data[0][0]) return data;
        } catch (e) {}
      }

      return null;
    }

    async function fetchAllIntervals() {
      const intervals = ["3m", "5m", "15m"];
      const manualCoins = document.getElementById("coinInput").value.split(",").map(c => c.trim().toUpperCase()).slice(0, 10);
      const results = [];

      for (let originalSymbol of manualCoins) {
        const row = { symbol: originalSymbol, signals: {}, data: null };
        for (let interval of intervals) {
          const data = await getValidKlines(originalSymbol, interval);
          if (!data) continue;

          const curr = data[data.length - 1];
          const close = parseFloat(curr[4]);
          const high = Math.max(...data.map(d => parseFloat(d[2])));
          const low = Math.min(...data.map(d => parseFloat(d[3])));
          const ema8 = calcEMA(data.slice(-8), 8);
          const ema13 = calcEMA(data.slice(-13), 13);

          let signal = "EMA NONE";
          let signalClass = "ema-none";
          if (close > ema8 && ema8 > ema13) {
            signal = "EMA LONG";
            signalClass = "ema-long";
          } else if (close < ema8 && ema8 < ema13) {
            signal = "EMA SHORT";
            signalClass = "ema-short";
          }

          row.signals[interval] = { signal, signalClass, close, high, low, data };
          if (!row.data) row.data = data;
        }
        results.push(row);
      }
      renderMultiIntervalTable(results);
    }

    function renderMultiIntervalTable(rows) {
      const tbody = document.querySelector("#radar-table tbody");
      tbody.innerHTML = "";

      rows.forEach(row => {
        const tr = document.createElement("tr");
        const signal3 = row.signals["3m"] || {};
        const signal5 = row.signals["5m"] || {};
        const signal15 = row.signals["15m"] || {};

        const close = signal3.close || 0;
        const high = signal3.high || 0;
        const low = signal3.low || 0;

        tr.innerHTML = `
          <td>${row.symbol}</td>
          <td>${close.toFixed(6)} <span style='color:gray'>(H-${high.toFixed(6)},L-${low.toFixed(6)})</span></td>
          <td class="${signal3.signalClass || 'ema-none'}">${signal3.signal || '---'}</td>
          <td class="${signal5.signalClass || 'ema-none'}">${signal5.signal || '---'}</td>
          <td class="${signal15.signalClass || 'ema-none'}">${signal15.signal || '---'}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function updateRefreshCounter() {
      refreshCountdown--;
      if (refreshCountdown <= 0) {
        fetchAllIntervals();
        refreshCountdown = 60;
      }
      document.getElementById("refresh-counter").textContent = `‚è≥ ${refreshCountdown}`;
    }

    setInterval(updateRefreshCounter, 1000);
    fetchAllIntervals();
  </script>
</body>
</html>
